trigger:
- main

pool:
  name: 'targetpool'   # self-hosted agent

steps:
# üî• IMPORTANT: full git history
- checkout: self
  fetchDepth: 0

#1Ô∏è‚É£ Install dependencies
- task: PowerShell@2
  displayName: 'NPM Install'
  inputs:
    targetType: 'inline'
    script: |
      npm install


# 6Ô∏è‚É£ Build React App (Deployment ke liye)
- task: PowerShell@2
  displayName: 'Build React App'
  inputs:
    targetType: 'inline'
    script: |
      npm run build

# 7Ô∏è‚É£ Archive BUILD
- task: ArchiveFiles@2
  displayName: 'Archive build'
  inputs:
    rootFolderOrFile: '$(System.DefaultWorkingDirectory)/build'
    includeRootFolder: false
    archiveType: 'zip'
    archiveFile: '$(Build.ArtifactStagingDirectory)/build.zip'
    replaceExistingArchive: true

# 8Ô∏è‚É£ Publish artifact
- task: PublishBuildArtifacts@1
  displayName: 'Publish Artifact'
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)'
    ArtifactName: 'react-build'
    publishLocation: 'Container'
- task: PowerShell@2
  displayName: sonarpush
  inputs:
    targetType: 'inline'
    script: |
      npm install -g @sonar/scan
      
      sonar -D sonar.host.url=http://34.239.246.240:9000 -D sonar.token=sqp_07173aa1ba575ae44dbe1d9f4733d4670d1425c5 -D sonar.projectKey=react
   

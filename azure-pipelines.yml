
trigger:
  - main
  - feature/*

pool:
  name: 'targetpool'   # self-hosted agent pool name

steps:
- task: PowerShell@2
  displayName: install
  inputs:
    targetType: 'inline'
    script: |
      npm install



- task: PowerShell@2
  displayName: build
  inputs:
    targetType: 'inline'
    script: 'npm run build'

- task: SonarQubePrepare@8
  displayName: 'Prepare SonarQube Analysis'
  inputs:
    targetType: 'inline'
    script: 'cd build/src'
    SonarQube: 'sonar k liye'   # service connection name
    scannerMode: 'cli'
    configMode: 'manual'
    cliProjectKey: 'react-app'
    cliProjectName: 'react-app'
    cliSources: 'src'
    extraProperties: |
      sonar.sourceEncoding=UTF-8
      sonar.javascript.lcov.reportPaths=coverage/lcov.info

# 5Ô∏è‚É£ üî• ACTUAL SCAN HAPPENS HERE
- task: SonarQubeAnalyze@8
  displayName: 'Run SonarQube Analysis'

# 6Ô∏è‚É£ Publish Quality Gate
- task: SonarQubePublish@8
  displayName: 'Publish SonarQube Quality Gate'
  inputs:
    pollingTimeoutSec: '300'


- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(System.DefaultworkingDirectory)\build'
    includeRootFolder: false
    archiveType: 'zip'
    archiveFile: '$(System.DefaultworkingDirectory)\build.zip'
    replaceExistingArchive: true

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)'
    ArtifactName: 'react ka project'
    publishLocation: 'Container'